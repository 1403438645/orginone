// Code generated by goctl. DO NOT EDIT!

package entitys

import (
	"context"
	"database/sql"
	"fmt"
	"strings"
	"time"

	"github.com/zeromicro/go-zero/core/stores/builder"
	"github.com/zeromicro/go-zero/core/stores/cache"
	"github.com/zeromicro/go-zero/core/stores/sqlc"
	"github.com/zeromicro/go-zero/core/stores/sqlx"
	"github.com/zeromicro/go-zero/core/stringx"
)

var (
	bladeLogApiFieldNames          = builder.RawFieldNames(&BladeLogApi{})
	bladeLogApiRows                = strings.Join(bladeLogApiFieldNames, ",")
	bladeLogApiRowsExpectAutoSet   = strings.Join(stringx.Remove(bladeLogApiFieldNames, "`create_time`", "`update_time`"), ",")
	bladeLogApiRowsWithPlaceHolder = strings.Join(stringx.Remove(bladeLogApiFieldNames, "`id`", "`create_time`", "`update_time`"), "=?,") + "=?"

	cacheAssetBladeLogApiIdPrefix = "cache:asset:bladeLogApi:id:"
)

type (
	bladeLogApiModel interface {
		Insert(ctx context.Context, data *BladeLogApi) (sql.Result, error)
		FindOne(ctx context.Context, id int64) (*BladeLogApi, error)
		Update(ctx context.Context, data *BladeLogApi) error
		Delete(ctx context.Context, id int64) error
	}

	defaultBladeLogApiModel struct {
		sqlc.CachedConn
		table string
	}

	BladeLogApi struct {
		Id          int64          `db:"id"`           // 编号
		TenantId    string         `db:"tenant_id"`    // 租户ID
		ServiceId   sql.NullString `db:"service_id"`   // 服务ID
		ServerHost  sql.NullString `db:"server_host"`  // 服务器名
		ServerIp    sql.NullString `db:"server_ip"`    // 服务器IP地址
		Env         sql.NullString `db:"env"`          // 服务器环境
		Tp          string         `db:"tp"`           // 日志类型
		Title       string         `db:"title"`        // 日志标题
		Method      sql.NullString `db:"method"`       // 操作方式
		RequestUri  sql.NullString `db:"request_uri"`  // 请求URI
		UserAgent   sql.NullString `db:"user_agent"`   // 用户代理
		RemoteIp    sql.NullString `db:"remote_ip"`    // 操作IP地址
		MethodClass sql.NullString `db:"method_class"` // 方法类
		MethodName  sql.NullString `db:"method_name"`  // 方法名
		Params      sql.NullString `db:"params"`       // 操作提交的数据
		Time        sql.NullString `db:"time"`         // 执行时间
		CreateBy    sql.NullString `db:"create_by"`    // 创建者
		CreateTime  time.Time      `db:"create_time"`  // 创建时间
	}
)

func newBladeLogApiModel(conn sqlx.SqlConn, c cache.CacheConf) *defaultBladeLogApiModel {
	return &defaultBladeLogApiModel{
		CachedConn: sqlc.NewConn(conn, c),
		table:      "`blade_log_api`",
	}
}

func (m *defaultBladeLogApiModel) Insert(ctx context.Context, data *BladeLogApi) (sql.Result, error) {
	assetBladeLogApiIdKey := fmt.Sprintf("%s%v", cacheAssetBladeLogApiIdPrefix, data.Id)
	ret, err := m.ExecCtx(ctx, func(ctx context.Context, conn sqlx.SqlConn) (result sql.Result, err error) {
		query := fmt.Sprintf("insert into %s (%s) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)", m.table, bladeLogApiRowsExpectAutoSet)
		return conn.ExecCtx(ctx, query, data.Id, data.TenantId, data.ServiceId, data.ServerHost, data.ServerIp, data.Env, data.Tp, data.Title, data.Method, data.RequestUri, data.UserAgent, data.RemoteIp, data.MethodClass, data.MethodName, data.Params, data.Time, data.CreateBy)
	}, assetBladeLogApiIdKey)
	return ret, err
}

func (m *defaultBladeLogApiModel) FindOne(ctx context.Context, id int64) (*BladeLogApi, error) {
	assetBladeLogApiIdKey := fmt.Sprintf("%s%v", cacheAssetBladeLogApiIdPrefix, id)
	var resp BladeLogApi
	err := m.QueryRowCtx(ctx, &resp, assetBladeLogApiIdKey, func(ctx context.Context, conn sqlx.SqlConn, v interface{}) error {
		query := fmt.Sprintf("select %s from %s where `id` = ? limit 1", bladeLogApiRows, m.table)
		return conn.QueryRowCtx(ctx, v, query, id)
	})
	switch err {
	case nil:
		return &resp, nil
	case sqlc.ErrNotFound:
		return nil, ErrNotFound
	default:
		return nil, err
	}
}

func (m *defaultBladeLogApiModel) Update(ctx context.Context, data *BladeLogApi) error {
	assetBladeLogApiIdKey := fmt.Sprintf("%s%v", cacheAssetBladeLogApiIdPrefix, data.Id)
	_, err := m.ExecCtx(ctx, func(ctx context.Context, conn sqlx.SqlConn) (result sql.Result, err error) {
		query := fmt.Sprintf("update %s set %s where `id` = ?", m.table, bladeLogApiRowsWithPlaceHolder)
		return conn.ExecCtx(ctx, query, data.TenantId, data.ServiceId, data.ServerHost, data.ServerIp, data.Env, data.Tp, data.Title, data.Method, data.RequestUri, data.UserAgent, data.RemoteIp, data.MethodClass, data.MethodName, data.Params, data.Time, data.CreateBy, data.Id)
	}, assetBladeLogApiIdKey)
	return err
}

func (m *defaultBladeLogApiModel) Delete(ctx context.Context, id int64) error {
	assetBladeLogApiIdKey := fmt.Sprintf("%s%v", cacheAssetBladeLogApiIdPrefix, id)
	_, err := m.ExecCtx(ctx, func(ctx context.Context, conn sqlx.SqlConn) (result sql.Result, err error) {
		query := fmt.Sprintf("delete from %s where `id` = ?", m.table)
		return conn.ExecCtx(ctx, query, id)
	}, assetBladeLogApiIdKey)
	return err
}

func (m *defaultBladeLogApiModel) formatPrimary(primary interface{}) string {
	return fmt.Sprintf("%s%v", cacheAssetBladeLogApiIdPrefix, primary)
}

func (m *defaultBladeLogApiModel) queryPrimary(ctx context.Context, conn sqlx.SqlConn, v, primary interface{}) error {
	query := fmt.Sprintf("select %s from %s where `id` = ? limit 1", bladeLogApiRows, m.table)
	return conn.QueryRowCtx(ctx, v, query, primary)
}

func (m *defaultBladeLogApiModel) tableName() string {
	return m.table
}
